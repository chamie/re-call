{"version":3,"sources":["../src/utils.ts","../src/index.ts"],"sourcesContent":["export const shallowEqual = <T>(prev: T, next: T): boolean => {\r\n    if (prev === next) return true;\r\n    if (typeof prev !== 'object' || typeof next !== 'object' || prev === null || next === null) {\r\n        return false;\r\n    }\r\n    const prevKeys = Object.keys(prev);\r\n    const nextKeys = Object.keys(next);\r\n    if (prevKeys.length !== nextKeys.length) return false;\r\n    for (const key of prevKeys) {\r\n        if (!Object.prototype.hasOwnProperty.call(next, key) || (prev as Record<string, any>)[key] !== (next as Record<string, any>)[key]) {\r\n            return false;\r\n        }\r\n    }\r\n    return true;\r\n};\r\n\r\nexport const parseRestParams = (fn: Function, rest: any[]) => {\r\n    const [paramsOrOptions, maybeOptions] = rest;\r\n    \r\n    if (fn.length === 0) {\r\n        return { params: [], options: paramsOrOptions ?? {} };\r\n    }\r\n    return { params: paramsOrOptions ?? [], options: maybeOptions ?? {} };\r\n};","import { ReCallOptions } from \"./types\";\r\nimport { parseRestParams, shallowEqual } from \"./utils\";\r\nimport deepEqual from \"fast-deep-equal\";\r\n\r\nconst defaultOptions: ReCallOptions = {\r\n    this: undefined,\r\n    thisArg: undefined,\r\n    comparator: Object.is,\r\n};\r\n\r\nlet cache = new WeakMap<Function, { result: any; params: any; thisArg: any }>();\r\n\r\nconst _reCall = <T extends (...args: any[]) => any>(\r\n    fn: T,\r\n    /** Parameters to pass to the function */\r\n    params: Parameters<T>,\r\n    /** Additional options to customize the behavior */\r\n    options: Partial<ReCallOptions<Parameters<T>>>\r\n): ReturnType<T> => {\r\n    const { this: thisContext, thisArg, comparator } = { ...defaultOptions, ...options };\r\n    /** The context to invoke the function with. Priority: options.this > options.thisArg > globalThis */\r\n    const thisValue = thisContext || thisArg || globalThis;\r\n    const cacheData = cache.get(fn);\r\n    if (cacheData && comparator(cacheData.params, params) && cacheData.thisArg === thisValue) {\r\n        return cacheData.result;\r\n    }\r\n\r\n    const result = fn.apply(thisValue, params);\r\n    cache.set(fn, { result, params, thisArg: thisValue });\r\n    return result;\r\n}\r\n\r\n/**\r\n * Memoize a function with no parameters\r\n */\r\nexport function byRef<T extends () => any>(\r\n    fn: T,\r\n    options?: Partial<ReCallOptions<[]>>\r\n): ReturnType<T>;\r\n\r\n/**\r\n * Memoize a function with parameters\r\n * @param fn - The function to memoize\r\n * @param params - The parameters to pass to the function\r\n * @param options - Memoization options\r\n */\r\nexport function byRef<T extends (...args: any[]) => any>(\r\n    fn: T,\r\n    params: Parameters<T>,\r\n    options?: Partial<ReCallOptions<Parameters<T>>>\r\n): ReturnType<T>;\r\n\r\n\r\nexport function byRef(fn: any, ...rest: any[]): any {\r\n    const { params, options } = parseRestParams(fn, rest);\r\n    return _reCall(fn, params, options);\r\n};\r\n\r\n/**\r\n * Memoize a function with no parameters, using shallow equality for comparison\r\n */\r\nexport function shallow<T extends () => any>(\r\n    fn: T,\r\n    options?: Partial<ReCallOptions<[]>>\r\n): ReturnType<T>;\r\n\r\n/**\r\n * Memoize a function with parameters using shallow equality for comparison\r\n * @param fn - The function to memoize\r\n * @param params - The parameters to pass to the function\r\n * @param options - Memoization options\r\n */\r\nexport function shallow<T extends (...args: any[]) => any>(\r\n    fn: T,\r\n    params: Parameters<T>,\r\n    options?: Partial<ReCallOptions<Parameters<T>>>\r\n): ReturnType<T>;\r\n\r\nexport function shallow(fn: any, ...rest: any[]): any {\r\n    const { params, options } = parseRestParams(fn, rest);\r\n    return _reCall(fn, params, { ...options, comparator: shallowEqual });\r\n};\r\n\r\n\r\n/**\r\n * Memoize a function with no parameters, using deep equality for comparison\r\n */\r\nexport function deep<T extends () => any>(\r\n    fn: T,\r\n    options?: Partial<ReCallOptions<[]>>\r\n): ReturnType<T>;\r\n\r\n/**\r\n * Memoize a function with parameters using deep equality for comparison\r\n * @param fn - The function to memoize\r\n * @param params - The parameters to pass to the function\r\n * @param options - Memoization options\r\n */\r\nexport function deep<T extends (...args: any[]) => any>(\r\n    fn: T,\r\n    params: Parameters<T>,\r\n    options?: Partial<ReCallOptions<Parameters<T>>>\r\n): ReturnType<T>;\r\n\r\nexport function deep(fn: any, ...rest: any[]): any {\r\n    const { params, options } = parseRestParams(fn, rest);\r\n    return _reCall(fn, params, { ...options, comparator: deepEqual });\r\n};\r\n\r\n\r\n// Wrappers:\r\n\r\nexport const wrap = <T extends (...args: any[]) => any>(\r\n    fn: T,\r\n    options?: Partial<ReCallOptions<Parameters<T>>>\r\n): T => \r\n    ((...params: Parameters<T>) => _reCall(fn, params, options ?? {})) as T;\r\n\r\n// Variants\r\nexport const wrapShallow = <T extends (...args: any[]) => any>(fn: T): T => \r\n    ((...params: Parameters<T>) => _reCall(fn, params, { comparator: shallowEqual })) as T;\r\n\r\nexport const wrapDeep = <T extends (...args: any[]) => any>(fn: T): T => \r\n    ((...params: Parameters<T>) => _reCall(fn, params, { comparator: deepEqual })) as T;\r\n\r\n\r\n/**\r\n * Clears the cache for a specific function.\r\n * @param fn Function, for which the cache record should be removed\r\n */\r\nexport const clearOne = (fn: Function) => {\r\n    cache.delete(fn);\r\n};\r\n\r\nexport const peek = (fn: Function) => {\r\n    const cacheData = cache.get(fn);\r\n    return cacheData ? cacheData.result : undefined;\r\n};\r\n\r\nexport const hasCache = (fn: Function) => cache.has(fn);\r\n\r\nexport const clearAll = () => {\r\n    cache = new WeakMap<Function, { result: any; params: any; thisArg: any }>();\r\n};\r\n\r\nexport default shallow;"],"mappings":"AAAO,IAAMA,EAAe,CAAIC,EAASC,IAAqB,CAC1D,GAAID,IAASC,EAAM,MAAO,GAC1B,GAAI,OAAOD,GAAS,UAAY,OAAOC,GAAS,UAAYD,IAAS,MAAQC,IAAS,KAClF,MAAO,GAEX,IAAMC,EAAW,OAAO,KAAKF,CAAI,EAC3BG,EAAW,OAAO,KAAKF,CAAI,EACjC,GAAIC,EAAS,SAAWC,EAAS,OAAQ,MAAO,GAChD,QAAWC,KAAOF,EACd,GAAI,CAAC,OAAO,UAAU,eAAe,KAAKD,EAAMG,CAAG,GAAMJ,EAA6BI,CAAG,IAAOH,EAA6BG,CAAG,EAC5H,MAAO,GAGf,MAAO,EACX,EAEaC,EAAkB,CAACC,EAAcC,IAAgB,CAC1D,GAAM,CAACC,EAAiBC,CAAY,EAAIF,EAExC,OAAID,EAAG,SAAW,EACP,CAAE,OAAQ,CAAC,EAAG,QAASE,GAAmB,CAAC,CAAE,EAEjD,CAAE,OAAQA,GAAmB,CAAC,EAAG,QAASC,GAAgB,CAAC,CAAE,CACxE,ECrBA,OAAOC,MAAe,kBAEtB,IAAMC,EAAgC,CAClC,KAAM,OACN,QAAS,OACT,WAAY,OAAO,EACvB,EAEIC,EAAQ,IAAI,QAEVC,EAAU,CACZC,EAEAC,EAEAC,IACgB,CAChB,GAAM,CAAE,KAAMC,EAAa,QAAAC,EAAS,WAAAC,CAAW,EAAI,CAAE,GAAGR,EAAgB,GAAGK,CAAQ,EAE7EI,EAAYH,GAAeC,GAAW,WACtCG,EAAYT,EAAM,IAAIE,CAAE,EAC9B,GAAIO,GAAaF,EAAWE,EAAU,OAAQN,CAAM,GAAKM,EAAU,UAAYD,EAC3E,OAAOC,EAAU,OAGrB,IAAMC,EAASR,EAAG,MAAMM,EAAWL,CAAM,EACzC,OAAAH,EAAM,IAAIE,EAAI,CAAE,OAAAQ,EAAQ,OAAAP,EAAQ,QAASK,CAAU,CAAC,EAC7CE,CACX,EAuBO,SAASC,EAAMT,KAAYU,EAAkB,CAChD,GAAM,CAAE,OAAAT,EAAQ,QAAAC,CAAQ,EAAIS,EAAgBX,EAAIU,CAAI,EACpD,OAAOX,EAAQC,EAAIC,EAAQC,CAAO,CACtC,CAsBO,SAASU,EAAQZ,KAAYU,EAAkB,CAClD,GAAM,CAAE,OAAAT,EAAQ,QAAAC,CAAQ,EAAIS,EAAgBX,EAAIU,CAAI,EACpD,OAAOX,EAAQC,EAAIC,EAAQ,CAAE,GAAGC,EAAS,WAAYW,CAAa,CAAC,CACvE,CAuBO,SAASC,EAAKd,KAAYU,EAAkB,CAC/C,GAAM,CAAE,OAAAT,EAAQ,QAAAC,CAAQ,EAAIS,EAAgBX,EAAIU,CAAI,EACpD,OAAOX,EAAQC,EAAIC,EAAQ,CAAE,GAAGC,EAAS,WAAYN,CAAU,CAAC,CACpE,CAKO,IAAMmB,EAAO,CAChBf,EACAE,KAEC,IAAID,IAA0BF,EAAQC,EAAIC,EAAQC,GAAW,CAAC,CAAC,GAGvDc,EAAkDhB,IAC1D,IAAIC,IAA0BF,EAAQC,EAAIC,EAAQ,CAAE,WAAYY,CAAa,CAAC,GAEtEI,EAA+CjB,IACvD,IAAIC,IAA0BF,EAAQC,EAAIC,EAAQ,CAAE,WAAYL,CAAU,CAAC,GAOnEsB,EAAYlB,GAAiB,CACtCF,EAAM,OAAOE,CAAE,CACnB,EAEamB,EAAQnB,GAAiB,CAClC,IAAMO,EAAYT,EAAM,IAAIE,CAAE,EAC9B,OAAOO,EAAYA,EAAU,OAAS,MAC1C,EAEaa,EAAYpB,GAAiBF,EAAM,IAAIE,CAAE,EAEzCqB,EAAW,IAAM,CAC1BvB,EAAQ,IAAI,OAChB,EAEOwB,EAAQV","names":["shallowEqual","prev","next","prevKeys","nextKeys","key","parseRestParams","fn","rest","paramsOrOptions","maybeOptions","deepEqual","defaultOptions","cache","_reCall","fn","params","options","thisContext","thisArg","comparator","thisValue","cacheData","result","byRef","rest","parseRestParams","shallow","shallowEqual","deep","wrap","wrapShallow","wrapDeep","clearOne","peek","hasCache","clearAll","index_default"]}